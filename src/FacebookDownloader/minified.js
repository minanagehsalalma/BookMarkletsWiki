javascript:(async()=>{const a=(s,d=document)=>[...d.querySelectorAll(s)],b=(u,o,c)=>{!u||u.startsWith("blob:")||c.has(u)||c.set(u,{u,...o})},t=v=>isFinite(v)?new Date(1e3*v).toISOString().substr(11,8):" ?",sz=v=>v?(v/1048576).toFixed(2)+" MB":" ?";{const m=location.href.match(/[?&]v=(\d{5,})/);m&&/facebook\.com\/watch/.test(location.href)&&history.replaceState(null,"",`https://www.facebook.com/story.php?story_fbid=${m[1]}&id=${m[1]}`)}const vids=[...new Map([...(()=>{const c=new Map;a("video").forEach(v=>{const o={w:v.videoWidth,h:v.videoHeight,d:v.duration};b(v.currentSrc||v.src,o,c),a("source",v).forEach(s=>b(s.src,o,c))}),a('meta[property="og:video"],meta[property="og:video:secure_url"]').forEach(m=>b(m.content,{},c)),a("[data-store]").forEach(e=>{let j=e.getAttribute("data-store");if(j)try{j=JSON.parse(j.replace(/&quot;/g,'"').replace(/&amp;/g,"&")),["src","hd_src","sd_src"].forEach(k=>b(j[k],{},c))}catch{}});return[...c.values()]})(),...(()=>{const s=new Set,re=/"(?:playable_url_quality_hd|playable_url|hd_src(?:_no_ratelimit)?|sd_src(?:_no_ratelimit)?)"\s*:\s*"([^"]+?\.mp4[^"]*?)"/g;a("script").forEach(sc=>{for(let m;m=re.exec(sc.textContent);)s.add(m[1].replace(/\\\//g,"/").replace(/\\u0025/gi,"%").replace(/\\u0026/gi,"&"))});return[...s].map(u=>({u}))})()].map(v=>[v.u,v])).values()];if(!vids.length)return alert("No video found.\n• Click the play button once, then run the bookmarklet again.");await Promise.all(vids.map(async v=>{try{v.sz=+(await fetch(v.u,{method:"HEAD"})).headers.get("content-length")||0}catch{v.sz=0}}));const gui=document.createElement("div");gui.id="fbDLgui",gui.innerHTML=`<style>#fbDLgui{position:fixed;inset:0;z-index:2147483647;background:#0004;backdrop-filter:blur(2px);}#fbDLbox{position:absolute;top:8vh;left:50%;transform:translateX(-50%);width:80%;max-width:700px;height:80vh;background:#fff;border-radius:10px;box-shadow:0 6px 24px #0003;display:flex;flex-direction:column;font:14px/1.4 sans-serif;}#fbDLhdr{display:flex;align-items:center;justify-content:space-between;padding:10px 16px;background:#4267B2;color:#fff;border-radius:10px 10px 0 0;}#fbDLhdr h2{margin:0;font-size:15px;font-weight:600;}#fbDLclose{border:none;background:none;color:#fff;font-size:22px;cursor:pointer;}#fbDLtbl{flex:1 1 auto;margin:0 16px 16px;overflow:auto;border:1px solid #ddd;}#fbDLtbl table{border-collapse:collapse;width:100%;}#fbDLtbl th,#fbDLtbl td{padding:6px 8px;text-align:left;border-bottom:1px solid #eee;font-size:13px;}#fbDLtbl th{background:#f5f6fa;position:sticky;top:0;}#fbDLtbl tr:hover{background:#fafbff;}</style><div id="fbDLbox"><div id="fbDLhdr"><h2>Facebook&nbsp;Video&nbsp;Downloader</h2><button id="fbDLclose">×</button></div><div id="fbDLtbl"><table><thead><tr><th>File</th><th>Resolution</th><th>Duration</th><th>Size</th></tr></thead><tbody></tbody></table></div></div>`;document.body.appendChild(gui);const tbody=gui.querySelector("tbody"),name=s=>s.length>40?`${s.slice(0,18)}…${s.slice(-18)}`:s;vids.forEach(v=>{const file=name(decodeURIComponent(v.u.split("/").pop().split("?")[0])||"(unnamed)"),res=v.w?`${v.w}×${v.h}`:" ?",row=document.createElement("tr");row.innerHTML=`<td><a href="${v.u}" target="_blank" download>${file}</a></td><td>${res}</td><td>${t(v.d)}</td><td>${sz(v.sz)}</td>`;tbody.appendChild(row)});gui.querySelector("#fbDLclose").onclick=()=>gui.remove();})();void 0;
